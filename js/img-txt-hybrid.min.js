var is_chrome=navigator.userAgent.indexOf('Chrome')>-1;var is_explorer=("ActiveXObject"in window);var is_firefox=navigator.userAgent.indexOf('Firefox')>-1;var is_safari=navigator.userAgent.indexOf("Safari")>-1;var is_Opera=navigator.userAgent.indexOf("Presto")>-1;if((is_chrome)&&(is_safari)){is_safari=false;} var RESIZE_OBJECT_SETTINGS,IMG_SETTINGS;;(function($,doc,win){"use strict";$.fn.suppressDefaults=function(){this.on("dragover",function(e){e.stopPropagation();e.preventDefault();});this.on("dragenter",function(e){e.stopPropagation();e.preventDefault();});} $.fn.attachDeleteButton=function(){var $TARGET=this;if(this.find(".delImg").length<1){var button=document.createElement('input');button.setAttribute('type','submit');button.setAttribute('value','X');button.setAttribute('class','delImg');var $button=$(button);$button.attr('id','delImg_'+$TARGET[0].id);$button.css({'position':'relative','bottom':'99%','float':'right','right':'1px','display':'none',});$TARGET.append($button);} else{$button=$("#"+'delImg_'+$TARGET[0].id.replace(".","\\."));console.log($button);} $TARGET.hover(function(){$button.show();},function(){$button.hide();});$button.on('click',function(event){event.preventDefault();event.stopPropagation();$(this).parent().remove();});} function createAndAppendImage(imgsrc,file,$TARGET){var $new_image_entity,$div_wrapper,new_div_entity,new_image_entity,final_width,final_height,target_height,randomized_id,randomized_id_2;randomized_id=Math.random().toString().slice(2);randomized_id_2=Math.random().toString().slice(2);randomized_id+="_"+randomized_id_2;if(typeof(file)!=='undefined'){new_image_entity=new Image();$new_image_entity=$(new_image_entity);$new_image_entity.attr('src',imgsrc);} else{$new_image_entity=$(imgsrc);} $new_image_entity[0].onload=function(){if($new_image_entity[0].width<=0||$new_image_entity[0].height<=0){alert('Upload Error! Try again\n');return false;} new_div_entity=document.createElement('div');new_div_entity.setAttribute('contenteditable','false');new_div_entity.setAttribute('class','upload-image');$div_wrapper=$(new_div_entity);target_height=parseInt($TARGET.css('height').replace('px',''));if($new_image_entity[0].height>target_height){final_height=target_height/2;final_width=($new_image_entity[0].width/$new_image_entity[0].height)*final_height;} else{final_height=$new_image_entity[0].height;final_width=$new_image_entity[0].width;} $div_wrapper.css({'width':final_width+"px",'height':final_height+"px",});$div_wrapper.attr('id',randomized_id);$div_wrapper.objectSettings(RESIZE_OBJECT_SETTINGS);$new_image_entity.objectSettings(IMG_SETTINGS);$div_wrapper.append($new_image_entity);$div_wrapper.imgInteract();$TARGET.append($div_wrapper)}} function fileDropHandler(event,$TARGET){var data,files,src,imgsrc;event.preventDefault();event.stopPropagation();var data=event.originalEvent.dataTransfer;var files=data.files;if(files.length<=0){src=event.originalEvent.dataTransfer.getData("URL");} function handleReadFile(file){var readFile=new FileReader();readFile.onload=function(event){event.preventDefault();event.stopPropagation();createAndAppendImage(readFile.result,file,$TARGET,RESIZE_OBJECT_SETTINGS,IMG_SETTINGS);} readFile.onerror=function(event){alert("Upload Failed! Try again.");} readFile.readAsDataURL(file);} if(typeof(src)!=="undefined"){alert("Try copy-pasting the image instead!")} else{for(var i=0;i<files.length;i++){handleReadFile(files[i]);}} $TARGET.attr('contenteditable','true');} function filePasteHandler(event,$TARGET){var imgsrc,source,result,plaintext;event.preventDefault();if(is_explorer){source=window.clipboardData.getData('URL');imgsrc="<img src='"+source+"'/>";plaintext=window.clipboardData.getData('text');if(source===""||typeof(source)==="undefined"){result=plaintext;} else{result=imgsrc;}} else if(!is_explorer){source=event.originalEvent.clipboardData.getData('text/html');plaintext=event.originalEvent.clipboardData.getData('text/plain');if(is_chrome||is_safari){imgsrc=source.match(/<!--StartFragment-->(.*)<!--EndFragment-->/);if(imgsrc!==null){result=imgsrc[1];}} else{imgsrc=source;result=imgsrc;} if(source===""||result===undefined){if(plaintext===""){alert("Try dragging and dropping the image!");plaintext="";} result=plaintext;}} if(result.indexOf("<img")>-1){createAndAppendImage(result,undefined,$TARGET,RESIZE_OBJECT_SETTINGS,IMG_SETTINGS);} else{try{window.document.execCommand('insertText',false,result);} catch(e){}}} $.fn.imgEvent=function(){var $TARGET=this;$TARGET.on('drop',function(event){fileDropHandler(event,$TARGET,RESIZE_OBJECT_SETTINGS,IMG_SETTINGS);});$TARGET.on('paste',function(event){filePasteHandler(event,$TARGET,RESIZE_OBJECT_SETTINGS,IMG_SETTINGS);});} $.fn.tabEnable=function(){var $TARGET=this;$TARGET.on('keydown',function(e){if(e.which==9){e.preventDefault();window.document.execCommand('insertText',false," ");}});} $.fn.imgInteract=function(){this.draggable({containment:'parent'});this.resizable({containment:"parent",handles:"s, e, se, w, sw",});this.attachDeleteButton();if(is_chrome){this.find('.ui-icon-gripsmall-diagonal-se').attr({'class':'ui-resizable-handle ui-resizable-se ui-icon-gripsmall-diagonal-se',});}} $.fn.primeDivs=function(){if(!is_firefox){this.html('<div><br></div>');} else{this.html('<p></p>');}} $.fn.objectSettings=function(setting_object){var $TARGET=this;$TARGET.css(setting_object);}})(jQuery,document,window);$.fn.refreshImgInteractions=function(){$upload_images=this.find(".upload-image");for(var idx=0;idx<$upload_images.length;idx++){$($upload_images[idx]).contents().remove('div.ui-resizable-handle');$($upload_images[idx]).unbind();$($upload_images[idx]).imgInteract();} $upload_images.on('click',function(event){$upload_images.css('z-index','0');$(this).css('z-index','10');});} function createAndAppendImgDivs(idGenFunction,img_source_str,css_obj,$target){var $div_wrapper,$new_image,genIdFunction;if(typeof(idGenFunction)!=="undefined"){genIdFunction=idGenFunction;} else{genIdFunction=function(){var randomized_id,randomized_id_2;randomized_id=Math.random().toString().slice(2);randomized_id_2=Math.random().toString().slice(2);return randomized_id+"_"+randomized_id_2;}} $div_wrapper=$(document.createElement('div'));$div_wrapper.attr({'id':genIdFunction(),'class':'upload-image',});$new_image=$(document.createElement('img'));$new_image.attr('src',img_source_str);$div_wrapper.objectSettings(RESIZE_OBJECT_SETTINGS);$div_wrapper.css(css_obj);$new_image.css(IMG_SETTINGS);$div_wrapper.append($new_image);$target.append($div_wrapper);} $.fn.px_to_percent=function(){var $THIS=this;function numerify(quality,parent){var target;if(parent){target=$THIS.parent();} else{target=$THIS;} return parseFloat(target.css(quality).replace("auto","0").replace("px",""));} function stringify(number){return number.toString();} var height_at_100_float,width_at_100_float,top_at_100_float,left_at_100_float,item_height_float,item_width_float,item_top_float,item_left_float;height_at_100_float=numerify('height',true);width_at_100_float=numerify('width',true);item_height_float=numerify('height',false);item_width_float=numerify('width',false);item_top_float=numerify('top',false);item_left_float=numerify('left',false);percent_height_percent=100*(item_height_float/height_at_100_float);percent_width_percent=100*(item_width_float/width_at_100_float);percent_top_percent=100*(item_top_float/height_at_100_float);percent_left_percent=100*(item_left_float/width_at_100_float);return([stringify(Math.floor(percent_top_percent))+"%",stringify(Math.ceil(percent_left_percent))+"%",stringify(percent_height_percent)+"%",stringify(percent_width_percent)+"%",]);} $.fn.countImages=function(){console.log(this.find('img').length);return this.find('img').length;} $.fn.imgSrc=function(percent){var result,img_list,item_obj,img_id,img_top,img_left,img_height,img_width,base64data_source,base64data_start,base64data,img_params;if(typeof(percent)==='undefined'){percent=false;} result=[];img_list=this.find('img');for(var img_idx=0;img_idx<img_list.length;img_idx++){img_id=$(img_list[img_idx]).parent().attr('id');if(percent){img_params=$(img_list[img_idx]).parent().px_to_percent();img_top=img_params[0];img_left=img_params[1];} else{img_top=$(img_list[img_idx]).parent().css('top');img_left=$(img_list[img_idx]).parent().css('left');} img_height=$(img_list[img_idx]).parent().css('height');img_width=$(img_list[img_idx]).parent().css('width');base64data_source=img_list[img_idx]['src'];if(base64data_source.indexOf('base64')>-1){base64data_start=base64data_source.indexOf('base64')+7;base64data=base64data_source.slice(base64data_start,base64data_source.length);} else{base64data=base64data_source;} item_obj={'id':img_id,'top':img_top,'left':img_left,'height':img_height,'width':img_width,'data':base64data,};result.push(item_obj);} return result;} $.fn.stringConvHTMLtoJS=function(){var result="";var buffer="";if(!is_firefox){$TARGET=this.contents().not(".upload-image");for(var i=0;i<$TARGET.length;i++){buffer+=jQuery($TARGET[i]).text()+"\n";} buffer=buffer.replace(/&nbsp;/g," ");result+=buffer;} else{string=this.html();str_end=string.indexOf('<div');result+=string.slice(0,str_end).replace(/<br>/g,'\n');} return result;} function stringConvJStoHTML(multiline_str){var result,strings,insert_item;if(is_firefox){return multiline_str.replace(/\n/g,'<br>');} else{result="";strings=multiline_str.split("\n");for(var str=0;str<strings.length;str++){if(strings[str]===""){insert_item="<br>";} else{insert_item=strings[str].replace(" ","&nbsp;");} result+="<div>"+insert_item+"</div>";} return result;}} $.fn.imgTxtHybrid=function(obj_settings){if(typeof(obj_settings)==='undefined'){RESIZE_OBJECT_SETTINGS={'overflow':'hidden','position':'absolute','white-space':'pre-wrap','display':'inline-block',}} else{try{RESIZE_OBJECT_SETTINGS=obj_settings;} catch(error){console.log(error);}} IMG_SETTINGS={'display':'block','width':100+'%','height':100+'%',} this.attr('contenteditable','true');this.css({'position':'relative','overflow':'auto',});this.suppressDefaults();this.primeDivs();this.imgEvent();this.tabEnable();}